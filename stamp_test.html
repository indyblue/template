<!DOCTYPE html>

<html>

 <head>
	<meta http-equiv="Content-Type" content="text/html;charset=ISO-8859-1">
  <title>Attributes example</title>
  <script type="text/javascript" src='stamp.js'></script>
  <script type="text/javascript" src='stamp2.js'></script>
 </head>

<body>
	<template id='one'>
		<h3 class='a b c d' style='' data-f='' data-q='r'>List {{ name }} {{ b.selse }}</h3>
		<div class='a b c d' style='' data-f='' data-q='r'>(b.c[2].e): {{ b.c.2.e }}</div>
		<ul  class='a b c d' style='' data-f='' data-q='r'data-repeat-i-thing='lst'>
			<li  class='a b c d' style='' data-f='' data-q='r' data-idx='li-idx-{{ i.idx }}'>
				<i class='a b c d' style='' data-f='' data-q='r'>{{ i.idx }}/{{^.lst.length}}</i> 
				<b class='a b c d' style='' data-f='' data-q='r'>{{ i.name }}</b> - {{ i.descr }}</li>
		</ul>
		<div class='a b c d' style='' data-f='' data-q='r'>nested lists</div>
		<ul  class='a b c d' style='' data-f='' data-q='r'data-repeat-i-a='q'>
			<li class='a b c d' style='' data-f='' data-q='r'>Number {{ i.a }}
			<ul  class='a b c d' style='' data-f='' data-q='r'data-repeat-j-a='i.r'>
				<li class='a b c d' style='' data-f='' data-q='r'>
					{{ ^.^.q.length }}|{{ ^.i.r.length }}|{{ ^.i.a }}|{{ j }}</li>
			</ul></li>
		</ul>
	</template>
	<template id='two'>
	</template>

	<div id='target'></div>
 <script>
 	function rstring(len) {
		let a = "a".charCodeAt(0);
		let rv = '';
		for(let i=0;i<len;i++){
			rv+= String.fromCharCode(a + Math.random()*26);
		}
		return rv;
	}
	let data = {name:'big list',
		b:{selse:'and then something else',
			c:[10,20,{d:1,e:4}]
		}
	}
	let lst = data.lst = [];
	for(let i=0;i<100;i++){
		lst.push({name:rstring(30), descr:rstring(80), idx:i+1});
	}
	data.q=[];
	for(let i=0;i<100;i++){
		data.q[i]={a:i,r:[]};
		for(let j=0;j<50;j++){
			data.q[i].r[j] = j;
		}
	}
	/*
	console.time('ctx-pre');
	var ctx = new Stamp.Context();
	console.timeEnd('ctx-pre');
	console.time('ctx');
	Stamp.expandInto(document.getElementById('target'), ctx.import('one'), data);
	console.timeEnd('ctx');
	// */
	//*
	console.time('stamp2-pre');
	let b = document.getElementById('one');
	let out = document.getElementById('target');

	let t = new Template(b);
	console.timeEnd('stamp2-pre');
	//console.log(JSON.stringify(t,null,3));
	console.time('stamp2');

	t.append(out, t.exec(data));
	console.timeEnd('stamp2');
	//*/
 </script>
</body>
</html>
