<!DOCTYPE html>

<html>

<head>
	<meta http-equiv="Content-Type" content="text/html;charset=ISO-8859-1">
	<title>Attributes example</title>
	<script type="text/javascript" src='stamp2.js'></script>
	<style>
		template { display:none }
	</style>
</head>

<body>
	<template id='one'>
		<h3 class='a b c d' style='' data-f='' data-q='r'>List {{ name }} {{ b.selse }}</h3>
		<div class='a b c d' style='' data-f='' data-q='r'>(b.c[2].e): {{ b.c.2.e }}</div>
		<ul  class='a b c d' style='' data-f='' data-q='r'data-repeat-i-thing='lst'>
			<li  class='a b c d' style='' data-f='' data-q='r' data-idx='li-idx-{{ i.idx }}'>
				<i class='a b c d' style='' data-f='' data-q='r'>{{ i.idx }}/{{^.lst.length}}</i>
				<b class='a b c d' style='' data-f='' data-q='r'>{{ i.name }}</b> - {{ i.descr }}</li>
		</ul>
		<div class='a b c d' style='' data-f='' data-q='r'>nested lists</div>
		<ul  class='a b c d' style='' data-f='' data-q='r'data-repeat-i-a='q'>
			<li class='a b c d' style='' data-f='' data-q='r'>Number {{ i.a }}
			<ul  class='a b c d' style='' data-f='' data-q='r'data-repeat-j-a='i.r'>
				<li class='a b c d' style='' data-f='' data-q='r'>
					{{ ^.^.q.length }}|{{ ^.i.r.length }}|{{ ^.i.a }}|<input onchange='{{^.^.jones}}' name='funk' value='{{ j.name }}' data-key='{{j.key}}'/></li>
			</ul></li>
		</ul>
	</template>
	<template id='two'>
	</template>
	<input id='bigtime' value='asdf' onkeyup='jones.bind(this)(event)'/>
	<div id='target'></div>
<script>
	'use strict';
	var btinp = document.querySelector('#bigtime');
	//console.dir(btinp);
	//btinp.onkeyup = jones;
	function jones(d,e){
		d.j.name=this.value;
		console.log(d.j);
	}
	function rstring(len) {
		var a = "a".charCodeAt(0);
		var rv = '';
		for(var i=0;i<len;i++){
			rv+= String.fromCharCode(a + Math.random()*26);
		}
		return rv;
	}
	var data = {name:'big list', jones:jones,
		b:{selse:'and then something else',
			c:[10,20,{d:1,e:4}]
		}
	}
	var lst = data.lst = [];
	for(var i=0;i<10;i++){
		lst.push({name:rstring(30), descr:rstring(80), idx:i+1});
	}
	data.q=[];
	for(var i=0;i<10;i++){
		data.q[i]={a:i,r:[]};
		for(var j=0;j<5;j++){
			data.q[i].r[j] = {name:rstring(10), key:j};
		}
	}
	/*
	console.time('ctx-pre');
	var ctx = new Stamp.Context();
	console.timeEnd('ctx-pre');
	console.time('ctx');
	Stamp.expandInto(document.getElementById('target'), ctx.import('one'), data);
	console.timeEnd('ctx');
	// */
	//*
	console.time('stamp2-pre');
	var b = document.getElementById('one');
	var out = document.getElementById('target');

	var t = new Template(b);
	console.timeEnd('stamp2-pre');
	//console.log(JSON.stringify(t,null,3));
	console.time('stamp2');

	t.append(out, t.exec(data));
	console.timeEnd('stamp2');
	//*/
</script>
</body>
</html>
