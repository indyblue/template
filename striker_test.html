<!DOCTYPE html>

<html>

<head>
	<meta http-equiv="Content-Type" content="text/html;charset=ISO-8859-1">
	<title>Attributes example</title>
	<script type="text/javascript" src='striker.js'></script>
	<style>
		template {
			display: none
		}
		h3 { margin:0;}
		.card {
			display:inline-block;
			min-width:20em;
			margin:.5em;
			border:.5em inset blue;
			background:lightblue;
			border-radius: 1em;
			padding:.5em;
		}
		.section {
			padding: 3px 0;
			margin: 3px 0;
			border: 1px solid blue;
		}
	</style>
</head>

<body>
	<template id='persons'><div data-repeat-i=''>
		<div data-prefix='i' data-template='#person'></div>
	</div></template>

	<template id='person'><div class='card'>
		<h3>{{last}}, {{first}}</h3>
		<div><i>Birthday:</i> {{birthday}}</div>
		<div class='section'>Contacts:
			<div data-repeat-i='contacts'><div data-prefix='i' data-template='#contact'></div></div>
		</div>
		<div class='section'>Addresses:
			<div data-repeat-i='addrs'><div data-prefix='i' data-template='#addr'></div></div>
		</div>
	</div></template>

	<template id='contact'><b>{{type}}</b> {{value}} <i>{{notes}}</i></template>
	<template id='addr'><b>{{type}}</b> {{addr1}}, {{city}}, {{state}}, {{zip}}</template>

	<script>
			'use strict';
			var striker = new Striker();
			var data = [{last:'jones', first:'fred', birthday:'Jan 2', 
							contacts:[{type:'email', value:'fred@jones.com', notes:'home'}, {type:'phone', value:'317-555-1212'}],
							addrs:[{type:'home', addr1:'123 Sesame St', city:'Timbuktu', state:'OK', zip:'12345'},
								{type:'work', addr1:'456 Noplace St', city:'Timbuktu', state:'OK', zip:'12354'}]},
						{last:'smith', first:'sally', birthday:'Feb 3', 
							contacts:[{type:'email', value:'sally@smith.com', notes:'work'}, {type:'phone', value:'312-555-1313'}],
							addrs:[{type:'home', addr1:'124 Sesame St', city:'Heartland', state:'IN', zip:'12345'},
								{type:'work', addr1:'454 Noplace St', city:'Chicago', state:'IL', zip:'12354'}]}];
			striker.expend(document.body, '#persons', data, true);
	</script>
	

	<template id='one'>
		<h3 class='a b c d' data-style='' data-f='' data-q='r'>List {{ name }} {{ b.selse }}</h3>
		<i data-template='#three'></i>
	</template>
	<template id='one2'>
		<ul class='a b c d' data-style='' data-f='' data-q='r' data-repeat-i-thing='lst'>
			<li class='a b c d' data-style='' data-f='' data-q='r' data-idx='li-idx-{{ i.idx }}'>
				<i class='a b c d' data-style='' data-f='' data-q='r'>{{ i.idx }}/{{^.lst.length}}</i>
				<b class='a b c d' data-style='' data-f='' data-q='r'>{{ i.name }}</b> - {{ i.descr }}</li>
		</ul>
	</template>
	<template id='one3'>
		<div class='a b c d' data-style='' data-f='' data-q='r'>nested lists</div>
		<ul class='a b c d' data-style='' data-f='' data-q='r' data-repeat-i-a='q'>
			<i data-template='#two'></i>
		</ul>
	</template>
	<template id='two'>
		<li class='a b c d' data-style='' data-f='' data-q='r'>Number {{ i.a }}
			<ul class='a b c d' data-style='' data-f='' data-q='r' data-repeat-j-a='i.r'>
				<li class='a b c d' data-style='' data-f='' data-q='r'>
					{{ ^.^.q.length }}|{{ ^.i.r.length }}|{{ ^.i.a }}|
					<input on-change='{{^.^.jones}}' name='funk' value='{{ j.name }}' data-key='{{j.key}}' />
				</li>
			</ul>
		</li>
	</template>
	<template id='three'>
		<div class='a b c d' data-style='' data-f='' data-q='r'>(b.c[2].e): {{ b.c.2.e }}</div>
	</template>
	<input id='bigtime' value='asdf' onkeyup='jones.bind(this)(event)' />
	<div id='target'></div>
	<script>
		'use strict';
		var btinp = document.querySelector('#bigtime');
		//console.dir(btinp);
		//btinp.onkeyup = jones;
		function jones(d, e) {
			d.j.name = this.value;
			console.log(d.j);
		}
		function rstring(len) {
			var a = "a".charCodeAt(0);
			var rv = '';
			for (var i = 0; i < len; i++) {
				rv += String.fromCharCode(a + Math.random() * 26);
			}
			return rv;
		}
		var data = {
			name: 'big list', jones: jones,
			b: {
				selse: 'and then something else',
				c: [10, 20, { d: 1, e: 4 }]
			}
		}
		var lst = data.lst = [];
		var imax = 10, jmax = 5;
		for (var i = 0; i < imax; i++) {
			lst.push({ name: rstring(30), descr: rstring(80), idx: i + 1 });
		}
		data.q = [];
		for (var i = 0; i < imax; i++) {
			data.q[i] = { a: i, r: [] };
			for (var j = 0; j < jmax; j++) {
				data.q[i].r[j] = { name: rstring(10), key: j };
			}
		}

		var striker = new Striker();
		var p = new Promise((res, err) => setTimeout(function () {
			striker.expend(document.body, '#one', data, true);
			res();
		}, 0)).then(x => new Promise((res, err) => setTimeout(function () {
			striker.expend(document.body, '#one2', data, true);
			res();
		}, 100))).then(x => new Promise((res, err) => setTimeout(function () {
			striker.expend(document.body, '#one3', data, true);
			res();
		}, 100))).catch(x=> console.error(x));

	</script>
</body>

</html>